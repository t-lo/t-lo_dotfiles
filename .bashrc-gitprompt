# from: http://rusty.ozlabs.org/?p=359
# source this in your '.ashrc' file.
__git_ps1 ()
{
    local g="$(git rev-parse --git-dir 2>/dev/null)"
    if [ -n "$g" ]; then
        # branches, merge states, and bisects
        local r
        local b
        if [ -d "$g/../.dotest" ]
        then
            local b="$(git symbolic-ref HEAD 2>/dev/null)"
            r="|REBASING"
        elif [ -d "$g/.dotest-merge" ]
        then
            r="|REBASING"
            b="$(cat $g/.dotest-merge/head-name)"
        elif [ -f "$g/MERGE_HEAD" ]
        then
            r="|MERGING"
            b="$(git symbolic-ref HEAD 2>/dev/null)"
        else
            if [ -f $g/BISECT_LOG ]
            then
                r="|BISECTING"
            fi
            if ! b="$(git symbolic-ref HEAD 2>/dev/null)"
            then
                b="$(cut -c1-7 $g/HEAD)..."
            fi
        fi

        # state of the local working tree
        local flags=""
        local buf=`git status 2>&1`
        echo "$buf" | grep -q '^# Changes not staged for commit:' \
            && flags="${flags}*"
        echo "$buf" | grep -q '^# Changes to be committed:'       \
            && flags="${flags}^"

        [ -n "$flags" ] && flags=" ${flags}"
        printf " (%s%s)" "${b##refs/heads/}$r" "${flags}"
    fi
}

PS1='[\u@\h \W] $(__git_ps1) \$ '
